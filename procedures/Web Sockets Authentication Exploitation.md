---
id: 0f3566c6-3a0b-4d0e-869e-412e584456dd
name: Web Sockets Authentication Exploitation
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:41.314711+00:00'
updated_at: '2023-04-06T03:56:41.331902+00:00'
tactics:
- '[[Credential Access|TA0006 - Credential Access]]'
- '[[Defense Evasion|TA0005 - Defense Evasion]]'
- '[[Persistence|TA0003 - Persistence]]'
techniques:
- '[[Modify Authentication Process|T1556 - Modify Authentication Process]]'
sub_techniques:
- '[[Domain Controller Authentication|T1556.001 - Domain Controller Authentication]]'
- '[[Network Device Authentication|T1556.004 - Network Device Authentication]]'
- '[[Password Filter DLL|T1556.002 - Password Filter DLL]]'
- '[[Pluggable Authentication Modules|T1556.003 - Pluggable Authentication Modules]]'
tags:
- '[[Exploit]]'
- '[[Using ws-harness.py]]'
- '[[Web Sockets]]'
commands:
- '[[Authenticate User with WebSocket Harness]]'
- '[[Authentication]]'
- '[[Enumerating tables]]'
---

# Web Sockets Authentication Exploitation

## Summary

Web Sockets are a protocol that enables real-time communication between a client and a server. This procedure focuses on exploiting the authentication mechanism of a web socket server. An attacker can use the `ws-harness.py` script to authenticate as a user, fuzz the authentication mechanism, and e

## Description

# Description

Web Sockets are a protocol that enables real-time communication between a client and a server. This procedure focuses on exploiting the authentication mechanism of a web socket server. An attacker can use the `ws-harness.py` script to authenticate as a user, fuzz the authentication mechanism, and extract data using SQL injection. This procedure can be used to gain access to sensitive information or escalate privileges.

Technical explanation: Web Sockets use a handshake mechanism for authentication. The `ws-harness.py` script can be used to automate the process of sending the authentication handshake to the server. Once authenticated, an attacker can use fuzzing techniques to test the authentication mechanism for vulnerabilities. If a vulnerability is found, an attacker can use SQL injection to extract data from the server.

Business value: This procedure can be used by attackers to gain access to sensitive information such as user credentials or financial data. It can also be used to escalate privileges and gain access to critical systems.

## Requirements

1. Access to the target web socket server

1. Knowledge of the authentication mechanism used by the server

1. ws-harness.py script

## Defense

1. Implement proper input validation to prevent SQL injection attacks

1. Use secure authentication mechanisms such as multi-factor authentication

1. Monitor network traffic for suspicious activity

## Objectives

1. Authenticate as a user on a web socket server

1. Fuzz the authentication mechanism to find vulnerabilities

1. Extract data using SQL injection

# Instructions

1. To authenticate a user via web-socket, run the following command:

**Code**: [[python ws-harness.py -u "ws://dvws.local:8080/auth]]

> This command starts the ws-harness tool, which listens on a specified web-socket endpoint and sends a message template to the endpoint. The -u flag specifies the web-socket endpoint to connect to, and the -m flag specifies the path to the message template file. The message template file should contain the necessary data to authenticate the user. This command is useful for testing web-socket authentication functionality in web applications.

**Command** ([[Authenticate User with WebSocket Harness]]):

```bash
python ws-harness.py -u "ws://dvws.local:8080/authenticate-user" -m ./message.txt
```

2. Use this command to fuzz authentication by replacing the [FUZZ] keyword with different values.

**Code**: [[{"auth_user":"dGVzda==", "auth_pass":"[FUZZ]"}]]

> This command is used to test the authentication mechanism of a system by replacing the [FUZZ] keyword with different values. The auth_user field contains the base64 encoded username and the auth_pass field contains the password field that will be fuzzed. By using this command, the user can test whether the authentication mechanism is vulnerable to brute force attacks or not.

**Command** ([[Authentication]]):

```bash
{"auth_user":"dGVzda==", "auth_pass":"[FUZZ]"}
```

3. To extract data from a SQL injection vulnerability, use the 'sqlmap' tool with the specified options. The '-u' flag specifies the URL to test, followed by the '--tables' and '--dump' flags to extract table and data information. The '--tamper' flag specifies a tamper script to encode the payloads in base64 format, which can bypass certain security measures. 

**Code**: [[sqlmap -u http://127.0.0.1:8000/?fuzz=test --table]]

> -u: URL of the target website with the injection point
--tables: Extract the list of tables
--dump: Dump the content of the tables
--tamper: Use the specified script to encode payloads to bypass security measures

**Command** ([[Enumerating tables]]):

```bash
sqlmap -u http://127.0.0.1:8000/?fuzz=test --tables --tamper=base64encode --dump
```

## MITRE ATT&CK Mapping

### Tactics

- [[Credential Access|TA0006 - Credential Access]]
- [[Defense Evasion|TA0005 - Defense Evasion]]
- [[Persistence|TA0003 - Persistence]]

### Techniques

- [[Modify Authentication Process|T1556 - Modify Authentication Process]]

### Sub-Techniques

- [[Domain Controller Authentication|T1556.001 - Domain Controller Authentication]]
- [[Network Device Authentication|T1556.004 - Network Device Authentication]]
- [[Password Filter DLL|T1556.002 - Password Filter DLL]]
- [[Pluggable Authentication Modules|T1556.003 - Pluggable Authentication Modules]]

## Commands Used

- [[Authenticate User with WebSocket Harness]]
- [[Authentication]]
- [[Enumerating tables]]

## Tags

- [[Exploit]]
- [[Using ws-harness.py]]
- [[Web Sockets]]
