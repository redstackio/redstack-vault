---
id: 71e9ba02-9f5b-4a60-b0f1-e373d52a288e
name: DirtyCow Kernel Exploit for Linux Privilege Escalation
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:19.664402+00:00'
updated_at: '2023-04-10T20:34:35.103293+00:00'
tactics:
- '[[Collection|TA0009 - Collection]]'
techniques:
- '[[Data from Information Repositories|T1213 - Data from Information Repositories]]'
tags:
- '[[CVE-2016-5195 (DirtyCow)]]'
- '[[Kernel Exploits]]'
- '[[Linux - Privilege Escalation]]'
commands:
- '[[Accessing ClickNRoot exploit code]]'
- '[[Accessing dirtycow exploit code]]'
- '[[Compiling dirtycow exploit]]'
- '[[Setting dirty_writeback_centisecs to 0]]'
---

# DirtyCow Kernel Exploit for Linux Privilege Escalation

## Summary

DirtyCow is a privilege escalation vulnerability that affects the Linux kernel. It allows an attacker to gain write access to read-only memory mappings, which can then be used to escalate privileges on the system. This exploit takes advantage of a race condition in the way the kernel's memory subsy

## Description

# Description

DirtyCow is a privilege escalation vulnerability that affects the Linux kernel. It allows an attacker to gain write access to read-only memory mappings, which can then be used to escalate privileges on the system. This exploit takes advantage of a race condition in the way the kernel's memory subsystem handles copy-on-write (COW) pages. By repeatedly calling the COW function, an attacker can cause the system to grant write access to a read-only mapping.

From an offensive perspective, DirtyCow can be used to gain root access on a compromised system. This can be particularly useful in scenarios where the attacker has already gained access to a low-privileged account on the system but needs elevated privileges to achieve their goals. The technical details of the exploit are beyond the scope of this document, but it involves manipulating memory mappings and altering the reference count of a page.

The business value of this exploit lies in its ability to give an attacker complete control over a compromised system. This can lead to data theft, ransomware attacks, or the installation of additional malware on the system. It is therefore important for organizations to be aware of this vulnerability and take steps to mitigate its impact.

 

## Requirements

1. Access to a vulnerable Linux system

1. Knowledge of the system's kernel version and architecture

1. Ability to compile and run C code

 

## Defense

1. Regularly apply security updates to the Linux kernel to patch known vulnerabilities

1. Monitor system logs for signs of privilege escalation attempts

1. Implement least privilege access controls to limit the impact of a successful privilege escalation attack

 

## Objectives

1. Gain root access on a compromised Linux system

1. Escalate privileges from a low-privileged account

 

# Instructions

1. To use this exploit, follow these steps:
1. Set the dirty_writeback_centisecs value to 0 by running the following command: 'echo 0 > /proc/sys/vm/dirty_writeback_centisecs'
2. Compile the exploit code by running the following command: 'g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil'
3. Run the compiled exploit code by executing the binary file 'dcow'


 



**Code**: [[# make dirtycow stable
echo 0 > /proc/sys/vm/dirty]]



> This exploit targets a vulnerability in the Linux kernel that allows an attacker to escalate their privileges on the system. The vulnerability exists in the way the kernel handles copy-on-write (COW) operations on read-only memory mappings. By exploiting this vulnerability, an attacker can gain write access to read-only memory mappings, which can be used to escalate privileges on the system.

The 'dirty_writeback_centisecs' value is a kernel parameter that controls how often the kernel flushes dirty pages to disk. By setting this value to 0, we ensure that dirty pages are written to disk immediately, which is necessary for the exploit to work.

The exploit code is written in C++ and can be compiled using the provided command. Once compiled, the exploit code can be run to escalate privileges on the system.



**Command** ([[Compiling dirtycow exploit]]):

```bash
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil
```





**Command** ([[Setting dirty_writeback_centisecs to 0]]):

```bash
echo 0 > /proc/sys/vm/dirty_writeback_centisecs
```





**Command** ([[Accessing dirtycow exploit code]]):

```bash
https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs
```





**Command** ([[Accessing ClickNRoot exploit code]]):

```bash
https://github.com/evait-security/ClickNRoot/blob/master/1/exploit.c
```



## MITRE ATT&CK Mapping

### Tactics

- [[Collection|TA0009 - Collection]]

### Techniques

- [[Data from Information Repositories|T1213 - Data from Information Repositories]]

## Commands Used

- [[Accessing ClickNRoot exploit code]]
- [[Accessing dirtycow exploit code]]
- [[Compiling dirtycow exploit]]
- [[Setting dirty_writeback_centisecs to 0]]

## Tags

- [[CVE-2016-5195 (DirtyCow)]]
- [[Kernel Exploits]]
- [[Linux - Privilege Escalation]]


