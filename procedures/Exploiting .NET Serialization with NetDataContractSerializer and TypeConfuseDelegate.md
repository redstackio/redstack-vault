---
id: 21947048-6953-46b5-869c-d10b491a3653
name: Exploiting .NET Serialization with NetDataContractSerializer and TypeConfuseDelegate
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:55:59.133926+00:00'
updated_at: '2023-04-06T03:55:59.146752+00:00'
tactics:
- '[[Execution|TA0002 - Execution]]'
- '[[Initial Access|TA0001 - Initial Access]]'
techniques:
- '[[Exploitation for Client Execution|T1203 - Exploitation for Client Execution]]'
- '[[Exploit Public-Facing Application|T1190 - Exploit Public-Facing Application]]'
tags:
- '[[Formatters]]'
- '[[NetDataContractSerializer]]'
- '[[.NET Serialization]]'
---

# Exploiting .NET Serialization with NetDataContractSerializer and TypeConfuseDelegate

## Summary

Exploiting .NET serialization vulnerabilities can allow an attacker to execute arbitrary code on a target system. The NetDataContractSerializer is a formatter used for serializing and deserializing .NET objects. The TypeConfuseDelegate gadget can be used to exploit the deserialization process by tr

## Description

# Description

Exploiting .NET serialization vulnerabilities can allow an attacker to execute arbitrary code on a target system. The NetDataContractSerializer is a formatter used for serializing and deserializing .NET objects. The TypeConfuseDelegate gadget can be used to exploit the deserialization process by tricking the application into executing arbitrary code. This technique can be used for initial access and execution.

Technical Explanation: By crafting a malicious serialized object, an attacker can trigger the deserialization process and execute arbitrary code. The TypeConfuseDelegate gadget allows an attacker to specify a delegate method in the serialized object that will be executed during deserialization. By setting the delegate to a method that calls the Windows calculator (calc.exe), an attacker can execute arbitrary code on the target system.

Business Value: Exploiting .NET serialization vulnerabilities can allow an attacker to gain access to sensitive data or take control of a target system. This can result in data theft, financial loss, and reputational damage for the targeted organization.

## Requirements

1. Access to a vulnerable .NET application

## Defense

1. Implement input validation and output encoding to prevent malicious serialized objects from being processed

1. Use a whitelist of allowed types during deserialization to prevent the TypeConfuseDelegate gadget from being used

1. Monitor for suspicious network traffic and system activity that may indicate an attacker is attempting to exploit .NET serialization vulnerabilities

## Objectives

1. Execute arbitrary code on a target system

1. Gain initial access to a target system

# Instructions

1. Run the following command in a PowerShell terminal:

**Code**: [[.\ysoserial.exe -f NetDataContractSerializer -g Ty]]

> This command uses the ysoserial tool to generate a malicious serialized object using the NetDataContractSerializer formatter and the TypeConfuseDelegate gadget. The -c argument specifies the command to be executed, in this case the Windows calculator. The -o argument specifies the output format, in this case base64. The -t argument specifies that the output should be copied to the clipboard.

## MITRE ATT&CK Mapping

### Tactics

- [[Execution|TA0002 - Execution]]
- [[Initial Access|TA0001 - Initial Access]]

### Techniques

- [[Exploitation for Client Execution|T1203 - Exploitation for Client Execution]]
- [[Exploit Public-Facing Application|T1190 - Exploit Public-Facing Application]]

## Tags

- [[Formatters]]
- [[NetDataContractSerializer]]
- [[.NET Serialization]]
