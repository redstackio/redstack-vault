---
id: ea12c1b2-4287-4efa-8fc4-1b5b3ba51a4f
name: IIS Machine Key Exploitation
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:55:51.716844+00:00'
updated_at: '2023-04-10T20:21:11.214647+00:00'
tactics:
- '[[Credential Access|TA0006 - Credential Access]]'
techniques:
- '[[Unsecured Credentials|T1552 - Unsecured Credentials]]'
tags:
- '[[API Key Leaks]]'
- '[[Exploit]]'
- '[[IIS Machine Keys]]'
commands:
- '[[Encrypt connection strings]]'
---

# IIS Machine Key Exploitation

## Summary

IIS Machine Keys are used to encrypt and decrypt sensitive data such as session cookies, view state, and forms authentication tickets. If an attacker can obtain the machine keys, they can decrypt this sensitive data and potentially gain access to the application. In this procedure, we will exploit 

## Description

# Description

IIS Machine Keys are used to encrypt and decrypt sensitive data such as session cookies, view state, and forms authentication tickets. If an attacker can obtain the machine keys, they can decrypt this sensitive data and potentially gain access to the application. In this procedure, we will exploit a leaked machine key to decrypt sensitive data.

## Requirements

1. Access to a leaked machine key.

## Defense

1. Ensure that machine keys are kept confidential and not leaked.

1. Encrypt sensitive data at rest and in transit to prevent unauthorized access.

1. Monitor for abnormal activity and investigate any suspicious behavior.

## Objectives

1. Obtain the machine key for the target IIS server.

1. Decrypt sensitive data using the obtained machine key.

# Instructions

1. 

**Code**: [[<machineKey validationKey="87AC8F432C8DB844A4EFD02]]

> This command will display the validation and decryption keys of the machine key. These keys can be used to decrypt sensitive data.

2. The 'connectionStrings' parameter specifies the name of the section to decrypt. The '.' specifies the path to the web.config file. The 'DataProtectionConfigurationProvider' specifies the decryption provider to use.

**Code**: [[aspnet_regiis -pdf "connectionStrings" "." -prov "]]

> This command will decrypt the 'connectionStrings' section of the web.config file using the obtained machine key. This section may contain sensitive data such as database connection strings.

**Command** ([[Encrypt connection strings]]):

```bash
aspnet_regiis -pdf "connectionStrings" "." -prov "DataProtectionConfigurationProvider"
```

## MITRE ATT&CK Mapping

### Tactics

- [[Credential Access|TA0006 - Credential Access]]

### Techniques

- [[Unsecured Credentials|T1552 - Unsecured Credentials]]

## Commands Used

- [[Encrypt connection strings]]

## Tags

- [[API Key Leaks]]
- [[Exploit]]
- [[IIS Machine Keys]]
