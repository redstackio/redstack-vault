---
id: 76ebf319-88a9-4657-ac71-c1f983500c11
name: Exploiting PHP Deserialisation With Prebuilt Gadget
type: procedure
verified: true
submitted: true
created_at: '2020-08-23T12:52:30.780569+00:00'
updated_at: '2023-05-26T01:07:11.003215+00:00'
platforms:
- Web
tags:
- '[[Insecure Deserialisation]]'
- '[[Web Applications]]'
---

# Exploiting PHP Deserialisation With Prebuilt Gadget

**Status**: âœ“ Verified

## Summary

An attacker will manipulate the session cookie which is a serialised object by creating the malicious serialised object. 

## Description

# Description

An attacker will manipulate the session cookie which is a serialised object by creating the malicious serialised object.

# Instructions

1. Identify the GET request from the HTTP web history under proxy tab in burp suite.

2. Using burp decoder , decode the session cookie value. *Base64 decode* the cookie and observe that it is a serialised PHP object and also the cookie is signed using *SHA1-HMAC* hash.

3.Observe that the modified cookie value sent to the server will through an internal server since the cookie is digitally signed. Any changes to cookie will be detected the application's server.

4.Under site map , observe the */cgi-bin/phpinfo.php* request . Send the request to the repeater tab and send it to the server. Notice that the response has *secret key*.

5.Download PHPGGC" tool and use it to create the PHP serialised object. 

Use the below command :

*./phpggc Symfony/RCE4 exec 'rm /home/carlos/morale.txt' | base64*

6.Use the following php function to create a valid session cookie value. Send the request to the server .

*<?php
echo $payload = urlencode('{"token":"' . $object . '","sig_hmac_sha1":"' . hash_hmac('sha1', $object, $secretKey) . '"}');*

*Replace the secretkey from step 4 and object from step 5  (crerated using phpggc tool)*

## Platforms

- Web

## Tags

- [[Insecure Deserialisation]]
- [[Web Applications]]
