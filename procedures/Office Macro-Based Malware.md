---
id: 4be54b16-02c4-49a5-90af-897386521ae3
name: Office Macro-Based Malware
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:23.635067+00:00'
updated_at: '2023-04-10T20:36:57.655898+00:00'
tactics:
- '[[Execution|TA0002 - Execution]]'
- '[[Persistence|TA0003 - Persistence]]'
techniques:
- '[[Office Application Startup|T1137 - Office Application Startup]]'
- '[[User Execution|T1204 - User Execution]]'
tags:
- '[[DOCM - BadAssMacros]]'
- '[[Office - Attacks]]'
commands:
- '[[Create VBA for classic shellcode injection from raw shellcode]]'
- '[[Create VBA for indirect shellcode injection from raw shellcode]]'
- '[[Example for creating VBA for classic shellcode injection]]'
- '[[Help for BadAssMacros.exe]]'
- '[[List modules inside Doc/Excel file]]'
- '[[Purge Doc/Excel file]]'
---

# Office Macro-Based Malware

## Summary

Office Macro-Based Malware is a common technique used by attackers to gain initial access to a system. This technique involves a malicious macro embedded in a Microsoft Office document that, when executed, downloads and installs malware on the target system. The technique is effective because many 

## Description

# Description

Office Macro-Based Malware is a common technique used by attackers to gain initial access to a system. This technique involves a malicious macro embedded in a Microsoft Office document that, when executed, downloads and installs malware on the target system. The technique is effective because many users are accustomed to enabling macros in order to view content in Office documents. When the macro is executed, the malware is installed and the attacker gains a foothold on the target system.

From a technical perspective, the attacker creates a macro that is embedded in an Office document. The macro contains code that downloads and installs malware on the target system. The macro may also contain code that executes when the Office document is opened, ensuring that the malware is installed even if the user does not explicitly enable macros.

The business value of this technique is that it allows attackers to gain access to sensitive data and systems, which can then be used for further attacks or sold on the black market.

 

## Requirements

1. User must have Microsoft Office installed

1. User must have macros enabled

 

## Defense

1. Disable macros in Microsoft Office by default

1. Educate users on the risks of enabling macros

1. Use endpoint protection software to detect and block malicious macros

 

## Objectives

1. Gain initial access to a target system

1. Install malware on the target system

1. Gain access to sensitive data and systems

 

# Instructions

1. This JSON object contains the list of commands that can be used with BadAssMacros.

 



**Code**: [[BadAssMacros.exe -h

# Create VBA for classic shel]]



> The BadAssMacros tool can be used to create VBA macros for classic and indirect shellcode injection from raw shellcode. The tool can also be used to list modules inside a Doc/Excel file and purge Doc/Excel files. The following commands can be used with BadAssMacros:

1. -i <path_to_raw_shellcode_file>: This argument is used to specify the path to the raw shellcode file.
2. -w <doc/excel>: This argument is used to specify the type of file to be created or the type of file that is being processed.
3. -p no/yes: This argument is used to specify whether to preserve the original file or not.
4. -s classic/indirect: This argument is used to specify the type of shellcode injection to be used.
5. -c <caesar_shift_value>: This argument is used to specify the caesar shift value for classic shellcode injection.
6. -o <path_to_output_file>: This argument is used to specify the path to the output file.
7. -l: This argument is used to list modules inside a Doc/Excel file.
8. -m <module_name>: This argument is used to specify the name of the module to be purged from the Doc/Excel file.



**Command** ([[Help for BadAssMacros.exe]]):

```bash
BadAssMacros.exe -h
```





**Command** ([[Create VBA for classic shellcode injection from raw shellcode]]):

```bash
BadAssMacros.exe -i <path_to_raw_shellcode_file> -w <doc/excel> -p no -s classic -c <caesar_shift_value> -o <path_to_output_file>
```





**Command** ([[Example for creating VBA for classic shellcode injection]]):

```bash
BadAssMacros.exe -i .\Desktop\payload.bin -w doc -p no -s classic -c 23 -o .\Desktop\output.txt
```





**Command** ([[Create VBA for indirect shellcode injection from raw shellcode]]):

```bash
BadAssMacros.exe -i <path_to_raw_shellcode_file> -w <doc/excel> -p no -s indirect -o <path_to_output_file>
```





**Command** ([[List modules inside Doc/Excel file]]):

```bash
BadAssMacros.exe -i <path_to_doc/excel_file> -w <doc/excel> -p yes -l
```





**Command** ([[Purge Doc/Excel file]]):

```bash
BadAssMacros.exe -i <path_to_doc/excel_file> -w <doc/excel> -p yes -o <path_to_output_file> -m <module_name>
```



## MITRE ATT&CK Mapping

### Tactics

- [[Execution|TA0002 - Execution]]
- [[Persistence|TA0003 - Persistence]]

### Techniques

- [[Office Application Startup|T1137 - Office Application Startup]]
- [[User Execution|T1204 - User Execution]]

## Commands Used

- [[Create VBA for classic shellcode injection from raw shellcode]]
- [[Create VBA for indirect shellcode injection from raw shellcode]]
- [[Example for creating VBA for classic shellcode injection]]
- [[Help for BadAssMacros.exe]]
- [[List modules inside Doc/Excel file]]
- [[Purge Doc/Excel file]]

## Tags

- [[DOCM - BadAssMacros]]
- [[Office - Attacks]]


