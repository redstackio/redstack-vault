---
id: 2236ad4f-f507-453f-b9f4-89b1194c4371
name: Exploiting IIS Machine Keys to Generate ViewState for RCE
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:55:51.796217+00:00'
updated_at: '2023-04-10T20:21:11.565183+00:00'
tactics:
- '[[Credential Access|TA0006 - Credential Access]]'
- '[[Lateral Movement|TA0008 - Lateral Movement]]'
- '[[Persistence|TA0003 - Persistence]]'
techniques:
- '[[Exploitation of Remote Services|T1210 - Exploitation of Remote Services]]'
- '[[Server Software Component|T1505 - Server Software Component]]'
- '[[Unsecured Credentials|T1552 - Unsecured Credentials]]'
sub_techniques:
- '[[Credentials in Registry|T1552.002 - Credentials in Registry]]'
tags:
- '[[API Key Leaks]]'
- '[[Exploit]]'
- '[[Generate ViewState for RCE]]'
- '[[IIS Machine Keys]]'
---

# Exploiting IIS Machine Keys to Generate ViewState for RCE

## Summary

Exploiting IIS machine keys to generate ViewState for remote code execution (RCE) is a technique used to attack web applications. By generating a malicious ViewState, an attacker can execute arbitrary code on the server. This technique can be used to gain initial access to a system or to escalate p

## Description

# Description

Exploiting IIS machine keys to generate ViewState for remote code execution (RCE) is a technique used to attack web applications. By generating a malicious ViewState, an attacker can execute arbitrary code on the server. This technique can be used to gain initial access to a system or to escalate privileges. The technique involves generating a malicious ViewState using ysoserial and then sending a POST request with the generated ViewState to the same endpoint. The ViewState is generated using the IIS machine keys, which are used to encrypt and decrypt ViewState data. This technique can be used to bypass authentication mechanisms and execute code on the server.

 

## Requirements

1. Access to a vulnerable web application

1. Knowledge of the IIS machine keys

 

## Defense

1. Ensure that IIS machine keys are properly configured and secured

1. Implement input validation and output encoding to prevent injection attacks

1. Use a web application firewall to detect and block malicious requests

 

## Objectives

1. Generate a malicious ViewState using IIS machine keys

1. Execute arbitrary code on the server

 

# Instructions

1. 

 



**Code**: [[$ ysoserial.exe -p ViewState  -g TextFormattingRun]]



> The commands use ysoserial to generate malicious ViewState data. The ViewState is generated using the IIS machine keys, which are used to encrypt and decrypt ViewState data. The commands generate three different types of malicious ViewState data: TextFormattingRunProperties, TypeConfuseDelegate, and ActivitySurrogateSelectorFromFile. Each of these types of ViewState data can be used to execute arbitrary code on the server. The last command uses viewgen to generate a POST request with the generated ViewState data. The POST request should be sent to the same endpoint as the vulnerable web application. In Burp, the Key Characters in the payload should be URL encoded.

## MITRE ATT&CK Mapping

### Tactics

- [[Credential Access|TA0006 - Credential Access]]
- [[Lateral Movement|TA0008 - Lateral Movement]]
- [[Persistence|TA0003 - Persistence]]

### Techniques

- [[Exploitation of Remote Services|T1210 - Exploitation of Remote Services]]
- [[Server Software Component|T1505 - Server Software Component]]
- [[Unsecured Credentials|T1552 - Unsecured Credentials]]

### Sub-Techniques

- [[Credentials in Registry|T1552.002 - Credentials in Registry]]

## Tags

- [[API Key Leaks]]
- [[Exploit]]
- [[Generate ViewState for RCE]]
- [[IIS Machine Keys]]


