---
id: 5fde39a3-ae48-45d9-b704-2ced87a1749b
name: Insecure File Upload Exploit via Picture Compression
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:41.054075+00:00'
updated_at: '2023-04-10T20:24:34.115244+00:00'
tactics:
- '[[Command and Control|TA0011 - Command and Control]]'
- '[[Lateral Movement|TA0008 - Lateral Movement]]'
- '[[Persistence|TA0003 - Persistence]]'
- '[[Privilege Escalation|TA0004 - Privilege Escalation]]'
techniques:
- '[[Remote File Copy|T1105 - Remote File Copy]]'
- '[[Web Shell|T1100 - Web Shell]]'
tags:
- '[[Exploits]]'
- '[[Picture Compression]]'
- '[[Upload Insecure Files]]'
commands:
- '[[curl ''http://localhost/test.php?0=system'' --data "]]'
---

# Insecure File Upload Exploit via Picture Compression

## Summary

Insecure file upload is a vulnerability that allows an attacker to upload malicious files to a web server. Picture compression is often used to reduce the size of images before uploading them to a server. However, if the server does not properly validate the uploaded files, an attacker can upload a

## Description

# Description

Insecure file upload is a vulnerability that allows an attacker to upload malicious files to a web server. Picture compression is often used to reduce the size of images before uploading them to a server. However, if the server does not properly validate the uploaded files, an attacker can upload a malicious file disguised as an image. This can lead to remote code execution or other types of attacks. Attackers can use this technique to gain initial access to a system or to execute code on a compromised system.

Technical Explanation: The attacker uses the 'List Files' command to identify a vulnerable web application that allows file uploads. The attacker then creates a malicious file and renames it with an image file extension. The attacker compresses the file and uploads it to the vulnerable server. The server does not properly validate the file and stores it in a directory that is accessible to the attacker. The attacker can then execute the malicious code or gain access to the system.

Business Value: This exploit can lead to data theft, system compromise, and financial loss. It is important for organizations to properly validate uploaded files and implement secure coding practices to prevent this type of attack.

 

## Requirements

1. Access to a vulnerable web application

1. Ability to create a malicious file

1. Knowledge of picture compression techniques

 

## Defense

1. Implement secure coding practices to properly validate uploaded files

1. Use file type validation to ensure that only valid file types are accepted

1. Implement network segmentation to isolate web servers from critical systems

 

## Objectives

1. Gain access to a vulnerable web application

1. Upload a malicious file disguised as an image

1. Execute code on the compromised system

 

# Instructions

1. The 'ls' command is used to list the files and directories in the current directory. The 'curl' command is used to transfer data from or to a server. In this case, it is being used to execute the 'ls' command on the server. The 'localhost/test.php?0=system' is the URL of the server where the 'ls' command will be executed.

 



**Code**: [[curl 'http://localhost/test.php?0=system' --data "]]



> The 'curl' command is followed by the URL of the server where the command will be executed. The '--data' option is used to pass the command to be executed as a parameter. In this case, the 'ls' command is passed as a parameter with the value '1'. The server-side script will then execute the command and return the output to the client.



**Command** ([[curl 'http://localhost/test.php?0=system' --data "]]):

```bash
curl 'http://localhost/test.php?0=system' --data "1='ls'"
```



## MITRE ATT&CK Mapping

### Tactics

- [[Command and Control|TA0011 - Command and Control]]
- [[Lateral Movement|TA0008 - Lateral Movement]]
- [[Persistence|TA0003 - Persistence]]
- [[Privilege Escalation|TA0004 - Privilege Escalation]]

### Techniques

- [[Remote File Copy|T1105 - Remote File Copy]]
- [[Web Shell|T1100 - Web Shell]]

## Commands Used

- [[curl 'http://localhost/test.php?0=system' --data "]]

## Tags

- [[Exploits]]
- [[Picture Compression]]
- [[Upload Insecure Files]]


