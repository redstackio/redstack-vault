---
id: d59aeb15-c94b-4e7f-afff-e5f9831ff496
name: Server-Side Template Injection With a Custom Exploit
type: procedure
verified: true
submitted: true
created_at: '2020-08-24T08:30:48.284193+00:00'
updated_at: '2023-05-26T18:11:05.527968+00:00'
platforms:
- Web
tags:
- '[[owasp]]'
- '[[owasp top 10]]'
- '[[Server Side Template Injection]]'
- '[[SSTI]]'
- '[[Web Applications]]'
---

# Server-Side Template Injection With a Custom Exploit

**Status**: âœ“ Verified

## Summary

Injecting a custom exploit through templates could lead to server-side template injection attacks. 

## Description

# Description

Injecting a custom exploit through templates could lead to server-side template injection attacks.

# Procedure

1. Login into the application

2. In the file upload function, try to upload an invalid image. The error message discloses a method called user.setAvatar(). Observe the file path /home/carlos/User.php.

3. Upload a valid image and intercept the request. Set the blog-post-author-display parameter to *`user.setAvatar('/etc/passwd'*)`

4. Load the page containing your test comment to render the template. Notice that the error message indicates that you need to provide an image MIME type as the second argument. Provide the below argument and view the comment again to refresh the template
* `user.setAvatar('/etc/passwd','image/jpg'*)`

5. To read the file, load the avatar using `GET /avatar?avatar=wiener`. This will return the contents of the `/etc/passwd` file, confirming that you have access to arbitrary files.

6. Repeat this process to read the PHP file that was noted down earlier

*`user.setAvatar('/home/carlos/User.php','image/jpg'*)`

7. Set the target file as your avatar, then view the comment to execute the template

*`user.setAvatar('/home/carlos/.ssh/id_rsa','image/jpg'*)`

8. Invoke the `user.gdprDelete()`method and view the comment again

## Platforms

- Web

## Tags

- [[owasp]]
- [[owasp top 10]]
- [[Server Side Template Injection]]
- [[SSTI]]
- [[Web Applications]]
