---
id: ed914491-0842-4680-8291-b42248356be7
name: 'CORS Misconfiguration Exploitation: Origin Reflection'
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:55:54.984741+00:00'
updated_at: '2023-04-06T03:55:55.008788+00:00'
tactics:
- '[[Initial Access|TA0001 - Initial Access]]'
- '[[Persistence|TA0003 - Persistence]]'
- '[[Privilege Escalation|TA0004 - Privilege Escalation]]'
techniques:
- '[[External Remote Services|T1133 - External Remote Services]]'
- '[[Service Registry Permissions Weakness|T1058 - Service Registry Permissions Weakness]]'
tags:
- '[[CORS Misconfiguration]]'
- '[[Exploitation]]'
- '[[Vulnerable Example: Origin Reflection]]'
- '[[Vulnerable Implementation]]'
commands:
- '[[Access /endpoint API]]'
---

# CORS Misconfiguration Exploitation: Origin Reflection

## Summary

Cross-Origin Resource Sharing (CORS) is a security feature implemented by web browsers to restrict web page resources from being accessed by other domains. A misconfigured CORS policy can allow attackers to bypass the same-origin policy and access sensitive data or perform actions on behalf of the 

## Description

# Description

Cross-Origin Resource Sharing (CORS) is a security feature implemented by web browsers to restrict web page resources from being accessed by other domains. A misconfigured CORS policy can allow attackers to bypass the same-origin policy and access sensitive data or perform actions on behalf of the victim user. One way to exploit a CORS misconfiguration is through Origin Reflection, where an attacker sends a request to the victim server with a malicious Origin header that reflects back in the response Access-Control-Allow-Origin header, allowing the attacker to access sensitive data from the victim server. This technique can be used as an initial access vector in a larger attack campaign.

Technical Explanation: The vulnerable server allows the attacker's domain to access its resources by reflecting back the attacker's Origin header in the Access-Control-Allow-Origin header of the response. This misconfiguration can be exploited by sending a request to the victim server with a malicious Origin header, which reflects back in the response and allows the attacker to access sensitive data from the victim server.

Business Value: Exploiting a CORS misconfiguration can allow attackers to bypass security controls and access sensitive data or perform actions on behalf of the victim user, leading to data theft, fraud, and reputational damage.

## Requirements

1. Authenticated access to the victim server.

1. Knowledge of the victim server's CORS policy.

1. A web browser or a tool that can send HTTP requests with custom headers.

## Defense

1. Implement a strict CORS policy that only allows trusted domains to access the server's resources.

1. Use the 'Access-Control-Allow-Credentials' header to prevent attackers from accessing sensitive data using credentials from the victim server.

1. Regularly scan and test for CORS misconfigurations using automated tools and manual testing.

## Objectives

1. Exploit a CORS misconfiguration to gain access to sensitive data or perform actions on behalf of the victim user.

# Instructions

1. Send an HTTP GET request to the victim server with a malicious Origin header that reflects back in the response Access-Control-Allow-Origin header.

**Code**: [[GET /endpoint HTTP/1.1
Host: victim.example.com
Or]]

> The attacker sends an HTTP GET request to the victim server with a custom Origin header that contains the attacker's domain. The victim server responds with a 200 OK status code and includes the attacker's domain in the Access-Control-Allow-Origin header of the response, allowing the attacker to access sensitive data from the victim server.

**Command** ([[Access /endpoint API]]):

```bash
GET /endpoint HTTP/1.1
Host: victim.example.com
Origin: https://evil.com
Cookie: sessionid=... 

```

## MITRE ATT&CK Mapping

### Tactics

- [[Initial Access|TA0001 - Initial Access]]
- [[Persistence|TA0003 - Persistence]]
- [[Privilege Escalation|TA0004 - Privilege Escalation]]

### Techniques

- [[External Remote Services|T1133 - External Remote Services]]
- [[Service Registry Permissions Weakness|T1058 - Service Registry Permissions Weakness]]

## Commands Used

- [[Access /endpoint API]]

## Tags

- [[CORS Misconfiguration]]
- [[Exploitation]]
- [[Vulnerable Example: Origin Reflection]]
- [[Vulnerable Implementation]]
