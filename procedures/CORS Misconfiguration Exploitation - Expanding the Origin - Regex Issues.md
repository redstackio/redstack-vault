---
id: 21affca8-ffd0-4dee-a947-4eced9f9b509
name: CORS Misconfiguration Exploitation - Expanding the Origin / Regex Issues
type: procedure
verified: false
submitted: false
created_at: '2023-04-06T03:55:55.896203+00:00'
updated_at: '2023-04-10T20:21:19.208885+00:00'
tactics:
- '[[Execution|TA0002 - Execution]]'
- '[[Privilege Escalation|TA0004 - Privilege Escalation]]'
techniques:
- '[[Exploitation for Client Execution|T1203 - Exploitation for Client Execution]]'
- '[[Exploitation for Privilege Escalation|T1068 - Exploitation for Privilege Escalation]]'
tags:
- '[[CORS Misconfiguration]]'
- '[[Exploitation]]'
- '[[Vulnerable Example: Expanding the Origin / Regex Issues]]'
- '[[Vulnerable Implementation (Example 1)]]'
commands:
- '[[API Request to /endpoint]]'
- '[[Ping example.com]]'
---

# CORS Misconfiguration Exploitation - Expanding the Origin / Regex Issues

## Summary

Cross-Origin Resource Sharing (CORS) is a security feature implemented by web browsers to prevent malicious scripts from making requests to a different domain than the one that served the script. A CORS misconfiguration can occur when a server allows cross-domain requests from any origin or when it

## Description

# Description

Cross-Origin Resource Sharing (CORS) is a security feature implemented by web browsers to prevent malicious scripts from making requests to a different domain than the one that served the script. A CORS misconfiguration can occur when a server allows cross-domain requests from any origin or when it allows specific domains but does not properly validate them. This can lead to attackers being able to make unauthorized requests to a server and steal sensitive information. In this scenario, we will be exploiting a vulnerable implementation of CORS where the server expands the allowed origin using regex. The attacker will use this vulnerability to make unauthorized requests to the server and steal sensitive information.

## Requirements

1. Access to a vulnerable web application with a misconfigured CORS policy.

1. A web browser with the ability to modify HTTP requests.

## Defense

1. Implement a strict CORS policy that only allows requests from trusted domains.

1. Use regular expressions to validate the Origin header and ensure that it only contains trusted domains.

1. Implement server-side access controls to prevent unauthorized access to sensitive information.

## Objectives

1. Exploit the CORS misconfiguration to make unauthorized requests to the server.

1. Steal sensitive information from the server.

# Instructions

1. Craft a request to the vulnerable web application with a modified Origin header.

**Code**: [[example.com]]

> Craft an HTTP request to the vulnerable web application with a modified Origin header. The attacker can use a web browser plugin such as Modify Headers to modify the Origin header to include a malicious domain. The attacker can also use a tool such as cURL to craft the request manually.

**Command** ([[Ping example.com]]):

```bash
ping example.com
```

2. Make an unauthorized request to the server using the modified Origin header.

**Code**: [[GET /endpoint HTTP/1.1
Host: api.example.com
Origi]]

> Once the attacker has crafted the HTTP request with the modified Origin header, they can use it to make an unauthorized request to the server. The server will respond with the requested data and include the Access-Control-Allow-Origin header with the malicious domain. The attacker can then steal the sensitive information from the response.

**Command** ([[API Request to /endpoint]]):

```bash
GET /endpoint HTTP/1.1
Host: api.example.com
Origin: https://evilexample.com

```

## MITRE ATT&CK Mapping

### Tactics

- [[Execution|TA0002 - Execution]]
- [[Privilege Escalation|TA0004 - Privilege Escalation]]

### Techniques

- [[Exploitation for Client Execution|T1203 - Exploitation for Client Execution]]
- [[Exploitation for Privilege Escalation|T1068 - Exploitation for Privilege Escalation]]

## Commands Used

- [[API Request to /endpoint]]
- [[Ping example.com]]

## Tags

- [[CORS Misconfiguration]]
- [[Exploitation]]
- [[Vulnerable Example: Expanding the Origin / Regex Issues]]
- [[Vulnerable Implementation (Example 1)]]
